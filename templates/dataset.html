{% extends "base.html" %}
{% set title = "Dataset" %}
{% block content %}

<div class="bg-white rounded-2xl shadow-soft border border-slate-200 p-6">
  <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Browse Dataset</h1>
      <p class="mt-2 text-slate-600 text-sm">Cari URL di dataset, filter label, dan lakukan prediksi.</p>
    </div>

    <form method="GET" class="flex flex-col sm:flex-row gap-3">
      <input name="q" value="{{ q }}" placeholder="Cari URL (contains)"
        class="w-full sm:w-72 rounded-xl border border-slate-300 bg-white px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-indigo-500">
      <select name="label" class="rounded-xl border border-slate-300 bg-white px-4 py-3 text-sm">
        <option value="" {{ 'selected' if label_filter=='' else '' }}>All</option>
        <option value="legitimate" {{ 'selected' if label_filter=='legitimate' else '' }}>Legitimate (label=0)</option>
        <option value="phishing" {{ 'selected' if label_filter=='phishing' else '' }}>Phishing (label=1)</option>
      </select>
      <button class="rounded-xl bg-indigo-600 px-5 py-3 text-sm font-semibold text-white shadow-soft hover:bg-indigo-700">
        Apply
      </button>
    </form>
  </div>

  <div class="mt-6 overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="text-left text-slate-500 border-b">
        <tr>
          {% for c in cols %}
            <th class="py-2 pr-6">{{ c }}</th>
          {% endfor %}
          <th class="py-2">Action</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        {% for r in rows %}
          <tr>
            {% for c in cols %}
              <td class="py-2 pr-6 {{ 'break-all' if c=='URL' else '' }}">
                {% if c=='label' %}
                  {% if r[c]==1 %}
                    <span class="inline-flex items-center rounded-full bg-red-50 px-2 py-1 text-xs font-semibold text-red-700 ring-1 ring-inset ring-red-200">phishing</span>
                  {% else %}
                    <span class="inline-flex items-center rounded-full bg-emerald-50 px-2 py-1 text-xs font-semibold text-emerald-700 ring-1 ring-inset ring-emerald-200">legitimate</span>
                  {% endif %}
                {% else %}
                  {{ r[c] }}
                {% endif %}
              </td>
            {% endfor %}
            <td class="py-2">
              {% if 'URL' in r %}
                <form method="POST" action="{{ url_for('predict') }}">
                  <input type="hidden" name="url" value="{{ r['URL'] }}">
                  <button class="rounded-lg bg-indigo-600 px-3 py-2 text-xs font-semibold text-white hover:bg-indigo-700">Predict</button>
                </form>
              {% else %}
                —
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="mt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 text-sm text-slate-600">
    <div>
      Page <span class="font-medium">{{ page }}</span> / <span class="font-medium">{{ total_pages }}</span>
      • Total rows: <span class="font-medium">{{ total }}</span>
    </div>
    <div class="flex items-center gap-2">
      {% set prev_page = page-1 %}
      {% set next_page = page+1 %}
      <a class="rounded-lg border border-slate-300 bg-white px-3 py-2 hover:bg-slate-50 {{ 'pointer-events-none opacity-50' if page<=1 else '' }}"
         href="{{ url_for('dataset', q=q, label=label_filter, page=prev_page, page_size=page_size) }}">Prev</a>
      <a class="rounded-lg border border-slate-300 bg-white px-3 py-2 hover:bg-slate-50 {{ 'pointer-events-none opacity-50' if page>=total_pages else '' }}"
         href="{{ url_for('dataset', q=q, label=label_filter, page=next_page, page_size=page_size) }}">Next</a>
    </div>
  </div>
</div>

{% endblock %}
